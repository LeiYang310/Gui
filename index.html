<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>宇宙智能探测 - 信息联动版</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding-top: 30px; }
        input, button { padding: 8px 12px; margin: 5px; }
        input[type=range] { width: 200px; }
        .section { margin-top: 30px; border: 1px solid #ccc; padding: 15px; width: 350px; margin-left: auto; margin-right: auto; }
        h3 { margin-bottom: 15px; }
        #resultArea { margin-top: 30px; }
        pre { white-space: pre-wrap; text-align: left; display: inline-block; margin-top: 10px; }
    </style>
</head>
<body>

<h2>宇宙智能探测 - 信息联动版</h2>
<input type="text" id="nameInput" placeholder="请输入名称">
<button id="detectBtn">智能探测</button>

<div id="details" style="display:none;">
    <div class="section">
        <h3>内部参数</h3>
        情绪值： <span id="emotionVal">0</span><br>
        <input type="range" id="emotionSlider" min="0" max="100"><br><br>
        智能强度： <span id="intelligenceVal">0</span><br>
        <input type="range" id="intelligenceSlider" min="0" max="100"><br><br>
        外部压力： <span id="pressureVal">0</span><br>
        <input type="range" id="pressureSlider" min="0" max="100"><br><br>
    </div>
</div>

<div id="resultArea" style="display:none;">
    <h3>系统综合反馈</h3>
    <div id="resultText"></div>
</div>

<br><br>
<button onclick="goToOverview()">返回总览</button>

<script>
const probe = {
    status: "未激活",
    probeData: null,

    activate() {
        this.status = "已激活";
    },

    detect(name) {
        if (this.status !== "已激活") {
            alert("请先激活探头");
            return;
        }

        const infoData = fetchRealInfo(name);
        this.probeData = {
            "对象名称": name,
            "情绪值": infoData["情绪值"],
            "智能强度": infoData["智能强度"],
            "外部压力": infoData["外部压力"]
        };
        this.showResult();
    },

    showResult() {
        document.getElementById("details").style.display = "block";
        document.getElementById("resultArea").style.display = "block";

        const setVal = (id, key) => {
            document.getElementById(id + "Val").innerText = this.probeData[key];
            document.getElementById(id + "Slider").value = this.probeData[key];
            document.getElementById(id + "Slider").oninput = (e) => {
                this.probeData[key] = e.target.value;
                document.getElementById(id + "Val").innerText = e.target.value;
                syncToInformationLayer(this.probeData["对象名称"], key, e.target.value);
                this.showResult();
            };
        };

        setVal("emotion", "情绪值");
        setVal("intelligence", "智能强度");
        setVal("pressure", "外部压力");

        const score = Math.round(
            (parseFloat(this.probeData["情绪值"]) +
            parseFloat(this.probeData["智能强度"]) +
            parseFloat(this.probeData["外部压力"])) / 3
        );

        document.getElementById("resultText").innerHTML =
            `<pre>探测对象：${this.probeData["对象名称"]}\n综合评分：${score}</pre>`;
    }
};

// 模拟真实信息通路
function fetchRealInfo(name) {
    console.log(`探测真实信息：${name}`);
    return {
        "情绪值": random(0, 50),
        "智能强度": random(0, 50),
        "外部压力": random(0, 50)
    };
}

function syncToInformationLayer(targetName, key, value) {
    console.log(`信息联动：对象[${targetName}]，参数[${key}]已调整为：${value}`);
    if (typeof externalInterface !== "undefined") {
        externalInterface.updateParameter(targetName, key, value);
    }
    alert(`已联动信息层，参数【${key}】调整为：${value}`);
}

function random(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function goToOverview() {
    window.location.href = "system_overview.html";
}

probe.activate();
document.getElementById("detectBtn").onclick = () => {
    const name = document.getElementById("nameInput").value.trim();
    if (name === "") {
        alert("请输入名称再探测");
        return;
    }
    probe.detect(name);
};
</script>

</body>
</html>
